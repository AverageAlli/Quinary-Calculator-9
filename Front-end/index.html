<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="theme-overrides.css"/>
    <title>Quinary Calculator</title>
  </head>
  <body>
    <div>
      <h1>Quinary Calculator</h1>
      <div class="container">

        <div class="modeRow">
          <span>View result as:</span>
          <label>
            <select id="viewMode" aria-label="Result display base">
              <option value="5" selected>Quinary (base-5)</option>
              <option value="10">Decimal (base-10)</option>
            </select>
          </label>
        </div>

        <div class="screen" id="display"></div>

        <div class="buttonsContainer">
          <button class="clear" id="clearButton">C</button>
          <button class="operation" id="division">÷</button>
          <button class="operation" id="multiplication">×</button>
          <button class="operation" id="subtract">−</button>

          <button id="button4">4</button>
          <button id="button3">3</button>
          <button id="button2">2</button>
          <button class="operation" id="plus">+</button>

          <button id="button1">1</button>
          <button id="button0">0</button>
          <button class="equal" id="equal">=</button>
        </div>
      </div>
    </div>
    <script defer src="app.js">
      const display = document.getElementById("display");
      let currentExpression = "";

      function appendNumber(num) {
        currentExpression += num;
        display.textContent = currentExpression;
      }

      function appendOperator(operator) {
        const lastChar = currentExpression.slice(-1);

        if (currentExpression === "" && operator !== "-") {
          return;
        }

        if (
          lastChar === "+" ||
          lastChar === "-" ||
          lastChar === "x" ||
          lastChar === "÷"
        ) {
          currentExpression = currentExpression.slice(0, -1) + operator;
        } else {
          currentExpression += operator;
        }
        display.textContent = currentExpression;
      }

      document.getElementById("clearButton").addEventListener("click", () => {
        currentExpression = "";
        display.textContent = "";
      });

      document.getElementById("button0").addEventListener("click", () => {
        appendNumber("0");
      });
      document.getElementById("button1").addEventListener("click", () => {
        appendNumber("1");
      });
      document.getElementById("button2").addEventListener("click", () => {
        appendNumber("2");
      });
      document.getElementById("button3").addEventListener("click", () => {
        appendNumber("3");
      });
      document.getElementById("button4").addEventListener("click", () => {
        appendNumber("4");
      });

      document
        .getElementById("plus")
        .addEventListener("click", () => appendOperator("+"));
      document
        .getElementById("subtract")
        .addEventListener("click", () => appendOperator("-"));
      document
        .getElementById("multiplication")
        .addEventListener("click", () => appendOperator("x"));
      document
        .getElementById("division")
        .addEventListener("click", () => appendOperator("÷"));

      document.getElementById("equal").addEventListener("click", async function () {
        if (!currentExpression) {
            return
        };

        try {
          const response = await fetch("/calculate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ expression: currentExpression }),
          });

          const data = await response.json();

          if (data.result !== undefined) {
            currentExpression = data.result;
            display.textContent = currentExpression;
          } else {
            display.textContent = "Error";
            currentExpression = "";
          }
        } catch (error) {
          display.textContent = "Error";
          currentExpression = "";
        }
      });
    </script>
  </body>
</html>
